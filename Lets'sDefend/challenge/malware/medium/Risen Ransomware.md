# Risen Ransomware

## Challenge Description 
<img width="1184" height="350" alt="image" src="https://github.com/user-attachments/assets/c48ea4dd-6e96-4513-8d65-8b1e73f9336c" />

## Solution and Analysis 


#### Question 1: Which text file was opened by the malware after initializing a critical section?

*   **Method:** By examining the `main` function's control flow, we can observe the arguments being prepared for function calls. A string literal, `Risenlogs.txt`, is pushed onto the stack as a parameter for a subsequent subroutine.
*   **Finding:** The malware creates and opens a log file named `Risenlogs.txt` to record its activity.

<img width="377" height="301" alt="image" src="https://github.com/user-attachments/assets/92883cb6-3dca-4d03-a1e9-0f61adf4d9a8" />

---

#### Question 2: What is the mutex that was created by the malware?

*   **Method:** Following the initialization code, there is a call to the `CreateMutexW` API. The `lpName` parameter for this function is supplied just before the call, revealing the mutex name. This is a common technique for malware to ensure only one instance of itself is running on a system.
*   **Finding:** The mutex created by the malware is named `RISEN_MUTEX`.

<img width="717" height="256" alt="image" src="https://github.com/user-attachments/assets/13a7bff1-08cd-4b41-99db-f977eeb838de" />

---

#### Question 3: How many countries (system languages) does the malware prevent itself from running in?

*   **Method:**  It calls the `GetSystemDefaultUILanguage` API and compares the returned Language Code Identifier (LCID) against a hardcoded list. The disassembly graph shows a chain of five distinct comparison (`cmp`) and conditional jump (`jz`) instructions.
*   **Finding:** The malware avoids running in **5** different countries/languages.

<img width="396" height="251" alt="image" src="https://github.com/user-attachments/assets/7b6884e5-28b9-465a-b7a3-c0eff8a02b0b" />

---

#### Question 4: What is the address of GetSystemInfo? (In Hex)

*   **Method:** The address of an imported API function can be located in the Import Address Table (IAT), which resides in the `.idata` section. Using IDA's text search feature for "GetSystemInfo" directs us to its entry in this table.
*   **Finding:** The address for the `GetSystemInfo` API in the IAT is `00404B51`.

<img width="822" height="282" alt="Screenshot 2025-09-01 192026" src="https://github.com/user-attachments/assets/a089762b-8309-47ed-a03e-1f1861183867" />

---

#### Question 5: What is the first API that is resolved in the sub_403120 function?

*   **Method:** By navigating to the function `sub_403120`, we can inspect its code. The very first `call` instruction in this function resolves to a Windows API.
*   **Finding:** The first API resolved and called is `IsWow64Process`. This is typically used to determine if the 32-bit malware is running on a 64-bit operating system.

<img width="827" height="529" alt="image" src="https://github.com/user-attachments/assets/8673d61a-9c63-4a8e-b8b5-6ecc0838dd50" />

---

#### Question 6: What is the scheduled task name created by the malware?

*   **Method:** The malware establishes persistence by creating a scheduled task. Searching for the string `schtasks` (the command-line tool for managing scheduled tasks) leads to the code where the command is constructed. The arguments passed to this command include the task name.
*   **Finding:** The malware creates a scheduled task named `SystemDefense`.

<img width="1018" height="443" alt="Screenshot 2025-09-01 192337" src="https://github.com/user-attachments/assets/d193980a-0053-467d-8320-c69d8afd37e7" />

---

#### Question 7: What is the array name that contains the volume used by the ransomware to encrypt files?

*   **Method:** To find drives to encrypt, ransomware often enumerates system volumes using APIs like `GetDriveTypeW`. By locating calls to this function, we can identify associated data structures. The code shows a loop that references an array of offsets to check different drive letters.
*   **Finding:** The array used for volume enumeration is located at the address `off_44CB08`.

<img width="815" height="470" alt="Screenshot 2025-09-01 192624" src="https://github.com/user-attachments/assets/28826248-2344-4115-84cb-0553a3857282" />

---

#### Question 8: What is the Telegram username of the threat actor?

*   **Method:** Ransom notes and other embedded strings often contain contact information for the threat actor. A simple text search for keywords like "telegram" within the binary's string data reveals this information.
*   **Finding:** The threat actor's Telegram username is `@tokyosupp`.

<img width="880" height="468" alt="Screenshot 2025-09-01 192814" src="https://github.com/user-attachments/assets/b16919db-458d-4f2d-9df6-616e952d57ee" />


# In-Depth Analysis of Risen Ransomware

Following the initial static analysis, this section provides a comprehensive overview of the Risen ransomware's behavior, capabilities, and objectives. The findings are compiled into a behavioral narrative that follows the typical attack lifecycle, from initial execution to final impact.

## Executive Summary

Risen is a Windows-based ransomware variant designed to encrypt files on a victim's system and extort a ransom payment for their recovery. Its operational flow includes several key stages: environment checking, persistence establishment, system discovery, and data encryption. The malware employs defense evasion techniques, such as geo-fencing, to avoid infecting systems in specific regions (likely those of its developers). It establishes persistence through a scheduled task and uses a hardcoded Telegram username as its command-and-control/contact channel for ransom negotiations.

## Behavioral Analysis & Kill Chain

The operational flow of Risen can be broken down into several distinct phases, which align with tactics from the MITRE ATT&CK framework.

### Phase 1: Initial Execution & Defense Evasion

**(MITRE ATT&CK Tactics: Defense Evasion [T1480], Execution [T1204])**

Upon execution, Risen immediately performs a series of checks to ensure it is running in a suitable environment and to evade detection.

1.  **Singleton Execution:** The first operational step is to create a mutex named `RISEN_MUTEX`. This ensures that only one instance of the ransomware can run on the system at any given time, preventing potential conflicts or redundant encryption processes that could corrupt data or alert monitoring tools.

2.  **Geo-Fencing:** The malware calls the `GetSystemDefaultUILanguage` API to identify the system's default language. It then compares this language ID against a hardcoded list of five different languages. If a match is found, the malware terminates its execution. This technique is commonly used by threat actors from Commonwealth of Independent States (CIS) regions to avoid attacking systems within their own and allied countries, thereby reducing the risk of attracting local law enforcement attention.

3.  **Logging:** It initializes a log file, `Risenlogs.txt`, to record its actions. While this may seem counterintuitive for stealth, it could be a debugging feature left over from development or a way for the operator to troubleshoot failed infections.

### Phase 2: Persistence

**(MITRE ATT&CK Tactic: Persistence [T1053.005])**

To ensure its survival after a system reboot, Risen establishes a persistence mechanism.

*   **Scheduled Task:** The malware uses the Windows command-line utility `schtasks.exe` to create a new scheduled task. The task is named **`SystemDefense`**, a name chosen to blend in with legitimate system processes and avoid suspicion. This task is configured to execute the ransomware payload automatically, for example at user logon or system startup, guaranteeing the encryption process can resume if interrupted.

### Phase 3: Discovery

**(MITRE ATT&CK Tactic: Discovery [T1083])**

Before initiating encryption, the ransomware must identify which files and drives to target.

*   **Drive Enumeration:** Risen iterates through system volumes by calling the `GetDriveTypeW` API. It checks the type of each drive to specifically identify local fixed disks (like C:, D:, etc.) for encryption. This process is guided by an internal array (`off_44CB08`) containing the drive letters to check. This targeted approach ensures it focuses on high-value user data and system files located on local drives, while potentially ignoring network shares or removable media to reduce operational complexity and network noise.

### Phase 4: Impact

**(MITRE ATT&CK Tactic: Impact [T1486])**

The final and most destructive phase of the attack is the encryption of user data.

1.  **File Encryption:** After identifying target drives, Risen begins its encryption routine. It recursively scans directories for files with specific extensions (not detailed in this static analysis but a typical ransomware behavior) and encrypts their contents using a cryptographic algorithm. Once encrypted, the files are rendered inaccessible without the corresponding decryption key.

2.  **Ransom Demand & Command and Control:** After encryption, the malware's final step is to inform the victim of the attack and provide instructions for payment. Unlike sophisticated ransomware that uses Tor-based C2 servers, Risen relies on a direct, public communication channel. A ransom note (which is not directly visible but can be inferred) directs the victim to contact the threat actor via the Telegram username **`@risen_supp`**. This serves as the channel for negotiation, payment, and receiving the decryption tool.

## Indicators of Compromise (IoCs)

The following artifacts can be used to detect and respond to a Risen ransomware infection:

*   **File Hash (SHA256):** `350ba69da5c837dcb7dad72ced74396456d520fb917fb408c069d0dc726c6c66`
*   **Mutex:** `RISEN_MUTEX`
*   **Scheduled Task Name:** `SystemDefense`
*   **Log File Created:** `C:\Users\[Username]\AppData\Local\Temp\Risenlogs.txt` (or similar location)
*   **Threat Actor Contact:** Telegram: `@tokyosupp`

## Conclusion

Risen ransomware, while not overtly sophisticated in its C2 mechanism, demonstrates a functional and effective attack chain. It combines common but proven techniques for defense evasion, persistence, and impact. Its reliance on a public platform like Telegram for communication suggests a lower-tier or less-resourced threat actor, but its destructive capability remains significant. Defenders can effectively hunt for this threat by monitoring for the specific IoCs identified during this analysis, particularly the creation of the `SystemDefense` scheduled task and the `RISEN_MUTEX` mutex.

